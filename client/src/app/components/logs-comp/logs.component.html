<div class="logs-wrapper">
    <!-- GLOBAL VIEW -->
    @if (!selectedPilotSid) {
        <app-airport-map />
    }
    <!-- SELECTED PILOT VIEW -->
    @else {
        <app-selected-pilot class="selected-p"/>
    }
    
    @if (selectedPlane) {
        <div class="selected-pilot-info">
            
            
            <div class="active-steps">
                <app-clearance-block [clearance]="getMRecentClearance()"></app-clearance-block>
                @for (step of getActiveSteps(selectedPlane); track step.request_id) {
                    <app-request-log [step]="step"></app-request-log>
                }
            </div>
            <div class="info-box">
                <div class="pilot-header">
                    <div class="pilot-id" [ngStyle]="{'color': selectedPlane.color}">
                        {{ selectedPlane.sid.substring(0, 4).toUpperCase() }}
                    </div>
            
                    @if (hasMultiplePilot()) {
                        <div>
                            <button 
                                class="nav-btn" 
                                (click)="navigateToPilot('prev')"
                                [title]="'see previous pilot (use arrow keys to navigate)'"
                            >←</button>
                            <button 
                                class="nav-btn" 
                                (click)="navigateToPilot('next')"
                                [title]="'see next pilot (use arrow keys to navigate)'"
                            >→</button>
                        </div>
                    }
            
                    <!-- Logs Button -->
                <button 
                    class="logs-btn" 
                    (click)="viewPilotLogs()"
                    [title]="'View detailed logs for ' + selectedPlane.sid.substring(0,4).toUpperCase()"
                >
                    <span>More</span>
                    <svg class="logs-icon" viewBox="0 0 24 24" aria-hidden="true">
                        <g>
                            <g data-name="Layer 2">
                                <rect width="9.5" height="9.5" x="13.25" y="1.25" rx="1.75" fill="currentColor"></rect>
                                <path d="m22.733 16.763-3.496-3.496a1.753 1.753 0 0 0-2.474 0l-3.496 3.496a1.752 1.752 0 0 0 0 2.474l3.496 3.496a1.752 1.752 0 0 0 2.474 0l3.496-3.496a1.751 1.751 0 0 0 0-2.474z" fill="currentColor"></path>
                                <rect width="9.5" height="9.5" x="1.25" y="1.25" rx="1.75" fill="currentColor"></rect>
                                <rect width="9.5" height="9.5" x="1.25" y="13.25" rx="1.75" fill="currentColor"></rect>
                            </g>
                        </g>
                    </svg>
                </button>
                </div>
            
                @if (selectedPlane.plane) {
                    <div class="position-info">
                        <span><strong>Pos:</strong> {{ selectedPlane.plane.current_pos.name }}</span>
                        <span><strong>Dest:</strong> {{ selectedPlane.plane.final_pos.name }}</span>
                        <span><strong>Heading:</strong> {{ selectedPlane.plane.current_heading.toFixed(2) }}°</span>
                    </div>
                }
            </div>
        </div>
          
    }

    @if (controlsPanelActive) {
        <app-clearances-sticker class="clearances-sticker"></app-clearances-sticker>
    }
      
</div>
